name: Mover estrutura do Flip App

on:
  workflow_dispatch:

jobs:
  reorganizar:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do reposit√≥rio completo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Verificar se a pasta tools/source existe
        run: |
          echo "üì¶ Verificando pasta tools/source..."
          if [ ! -d tools/source ]; then
            echo "‚ùå tools/source n√£o encontrada. Aborto."
            exit 1
          fi
          if [ ! -f tools/source/package.json ]; then
            echo "‚ùå Nenhum Flip App v√°lido em tools/source. Falta o package.json"
            exit 1
          fi

      - name: Verificar se a pasta /flip j√° existe
        run: |
          if [ -d flip ]; then
            echo "‚ö†Ô∏è A pasta /flip j√° existe. Abortando para evitar sobrescrita."
            exit 1
          fi

      - name: Mover conte√∫do de tools/source para flip/
        run: |
          echo "üöö Movendo arquivos..."
          mkdir flip
          mv tools/source/* flip/

      - name: Limpar lixo antigo (zip ou source)
        run: |
          echo "üßπ Limpando tools/"
          rm -rf tools/source tools/flip-agentos.zip || true

      - name: Commitar reorganiza√ß√£o
        run: |
          git config user.name "agentos-auto-bot"
          git config user.email "infra@voulezvous.system"
          git add flip tools || echo "nada a adicionar"
          git diff --cached --quiet && echo '''üî∏ Nada mudou.''' || git commit -m "infra: reorganiza estrutura do Flip App para /flip"
          git push